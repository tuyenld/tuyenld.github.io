---
layout: post
featured-img: git
title: Git stuff
categories:
- linux
comments: true
---
## Common usages
### 1. config
```bash
git config --global user.email "ldtuyen@example.com"
git config --global user.name "ldtuyen Ubuntu"
git config --global alias.lg "log --color --graph --pretty=format:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit"
# =>	git lg to see better output
```

### 2. Usage
```bash
# >> Edit commit pushed (ONLY USE ON PERSONAL GITHUB)
# ERROR: > hint: Updates were rejected because the tip of your current branch is behind
# SOL: This should only be the case if you're amending an already-pushed commit. 
# https://stackoverflow.com/a/18589008/5407195

git add FILES
git commit --amend --no-edit
git push -f origin master

# >> resolve merge conflicts in Git?
# https://stackoverflow.com/a/163659/5407195

# Edit and reslove conflict
git mergetool
# Add new commit
git commit

# >> Git show certain commit
git show <revhash> 
# show full commit
git show --pretty=fuller {ID}

# >> View the change history of a file using Git versioning

gitk --follow [filename]
# also work with deleted file
git log --follow -p -- file

# >> rebase
# pull when there are some changes on remote
git pull --rebase
# rebase in progress; onto 9c168a5
git rebase --abort


# >> Git clean all untracked file and directory

# -d: Remove untracked directories in addition to untracked files. 
#   If an untracked directory is managed by a different Git repository, 
#   it is not removed by default. 
#   Use -f option twice if you really want to remove such a directory.
# -f, --force: If the Git configuration variable clean.
#    requireForce is not set to false, git clean will refuse to run 
#    unless given -f, -n or -i.
# -x: Don’t use the standard ignore rules read from .gitignore (per directory) 
#    and $GIT_DIR/info/exclude, but do still use the ignore rules given with -e options. 
#    This allows removing all untracked files, including build products. 
#    This can be used (possibly in conjunction with git reset) 
#    to create a pristine working directory to test a clean build.
git clean -xdf
git clean -f
git clean -df
git reset --hard origin/branch
git checkout .

# >> Gerrit add reviewer
ssh -p 29418 git.example.com gerrit set-reviewers \
-a someone@example.com \
-a whoever@example.com \
<shaID>
```

### Amend OLDER commit than HEAD on Gerrit

https://stackoverflow.com/a/8825163/5407195

### How do I update a GitHub forked repository?
```bash
# https://stackoverflow.com/a/7244456/14558037
# Add the remote, call it "upstream":

git remote add upstream https://github.com/whoever/whatever.git

# Fetch all the branches of that remote into remote-tracking branches,
# such as upstream/main or upstream/master:
git fetch upstream

# Make sure that you're on your main branch:
git checkout main #e.g master

# Rewrite your main branch so that any commits of yours that
# aren't already in upstream/main are replayed on top of that
# other branch:
git rebase upstream/main  #e.g master

# You only need to use the -f the first time after you've rebased.
git push -f origin main
```

## Rewriting history

Included `git commit --amend`, `git rebase` and `git reflog`

### `git commit --amend`
Change the last commit.

- It lets you combine **staged changes** with the previous commit instead of creating an entirely new commit.
- It replaces the most recent commit **entirely**, it does not just alter it.
  - **Don’t amend public commits**
  - Amended commits are actually entirely new commits and the previous commit will no longer be on your current branch. This is a confusing situation for developers to be in and it’s complicated to recover from.

![git-amend](/images/posts/git/git-amend.svg)

**Change most recent Git commit message**
```bash
git commit --amend -m "an updated commit message"
```

**Changing committed files**
```bash
# Edit hello.py and main.py 
git add hello.py 
git commit -m "add hello.py"
git log
# commit 9bc6ee171f9fdfff63d31cf3356214198d516e9b
# Author: Some One <someone@gmail.com>
# Date:   Fri Apr 9 02:45:56 2021 -0400

#     add hello

# Realize you forgot to add the changes from main.py 
git add main.py 
git commit --amend --no-edit
git log
# commit e951c3175126ce61a579fc4c2689d9bf4a16cb5f
# Author: Some One <someone@gmail.com>
# Date:   Fri Apr 9 02:45:56 2021 -0400

#     add hello
```
> Commit ID was changed, so the older commit ID will be removed if there is no reference to it.

**Changing older or multiple commits**

## Work in progress

https://marklodato.github.io/visual-git-guide/index-en.html
https://git-scm.com/book/en/v2/Git-Basics-Recording-Changes-to-the-Repository
 

## Giới thiệu 
![](/images/posts/git/git-gioi-thieu.svg)

Trong đó:
- `History` là lịch sử thay đổi file đã được lưu trữ bởi git.
- `Stage` chứa những file chuẩn bị cho commit lần tiếp theo.
- `Working Directory` là những file vật lý lưu trữ trên ổ cứng của bạn.

`3. git checkout file`  chỉ có tác dụng khi chưa `git add`, nếu đã add rồi thì phải `git reset` trước.  
`4. git reset file` dùng để **undo** `git add file`  

Dưới đây là vòng đời của file khi làm việc với git.

![](/images/posts/git/file-lifeCycle.svg)

Mỗi file sẽ nằm ở 1 trong 4 trạng thái: `Untracked`, `Unmodified`, `Modified` và `Staged`

# Gitlab
- [Code review and collaboration with Merge Requests](https://docs.gitlab.com/ee/university/training/topics/merge_requests.html)
- [New merge request from your local environment](https://docs.gitlab.com/ee/user/project/merge_requests/creating_merge_requests.html)
- [Code Review](https://github.com/thoughtbot/guides/tree/main/code-review)




